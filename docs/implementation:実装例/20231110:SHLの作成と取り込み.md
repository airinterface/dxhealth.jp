# SHLの作成と取り込み

IPSなど一回の情報の情報が多い場合、また携帯などでの保管が無理な場合は
情報のリンクのみを個人の意思で渡し、個人がそのリンクを教えた人、機関のみが閲覧できる基準をSHL(SMART® Health Link)と言います。

SHLはHLS7のFHIRのカテゴリーに入っており、国々を跨ぐ医療情報の提供方法として働きます。


情報の中身はFHIRの形式になっています。ここではSHLの処理用法とともに、医療保険の情報のシェアのユースケース、
それによって可能になる未来を取り上げてみました。


# SHLの目的

SHLの目的はFHIRのリソースを[SHL仕様](https://docs.smarthealthit.org/smart-health-links/spec)に基づき、情報開示します。

こちらも、
SHLを連絡するために渡す側はその際のパスコードを作成します。またリンクは仕様に沿えば、閲覧は
SHLの仕様に沿ったどのアプリケーションでも閲覧できることができます。

SHLの目標としては、一時的に、パスコードを使って暗号化したFHIRのデータをサーバーにおき、そのパスコードを
使い、どこからでも情報が取得できるために作られています。SHCと同じでQRコードなどで共有できますが、違いは
データ自体はそこに入っていません。

# SHL

![SHL](https://github.com/airinterface/dxhealth.jp/assets/2448586/d69719ac-546c-4129-a3c3-d64c513926f6)


# 共有方法
　TODO
　QRCode,Link

# 共有する内容
　共有されたリンクのコンテンツはSHLのプロトコル以降がメタデータとなります。それはBase64で
エンコードされたStringですが、それをデコードすると、下記の構造のJSONデータにデコードできます。

例）共有されたリンク
```
https://shctemp.z5.web.core.windows.net/shlink.html#shlink:/eyJ1cmwiOiJodHRwczovL3Jhdy5naXRodWJ1c2VyY29udGVudC5jb20vc2Vhbm5vL3NoYy1kZW1vLWRhdGEvbWFpbi9jYXJkcy9jaWduYS1kZXNpZ24vandzLnR4dCIsImZsYWciOiJMVSIsImtleSI6InJ4VGdZbE9hS0pQRnRjRWQwcWNjZU44d0VVNHA5NFNxQXdJV1FlNnVYN1EiLCJsYWJlbCI6IkRlbW8gU0hMIGZvciBjaWduYS1kZXNpZ24ifQ
```

SHLのデータ
```
shlink:/eyJ1cmwiOiJodHRwczovL3Jhdy5naXRodWJ1c2VyY29udGVudC5jb20vc2Vhbm5vL3NoYy1kZW1vLWRhdGEvbWFpbi9jYXJkcy9jaWduYS1kZXNpZ24vandzLnR4dCIsImZsYWciOiJMVSIsImtleSI6InJ4VGdZbE9hS0pQRnRjRWQwcWNjZU44d0VVNHA5NFNxQXdJV1FlNnVYN1EiLCJsYWJlbCI6IkRlbW8gU0hMIGZvciBjaWduYS1kZXNpZ24ifQ
```

Base64のデータ
```
eyJ1cmwiOiJodHRwczovL3Jhdy5naXRodWJ1c2VyY29udGVudC5jb20vc2Vhbm5vL3NoYy1kZW1vLWRhdGEvbWFpbi9jYXJkcy9jaWduYS1kZXNpZ24vandzLnR4dCIsImZsYWciOiJMVSIsImtleSI6InJ4VGdZbE9hS0pQRnRjRWQwcWNjZU44d0VVNHA5NFNxQXdJV1FlNnVYN1EiLCJsYWJlbCI6IkRlbW8gU0hMIGZvciBjaWduYS1kZXNpZ24ifQ
```

デコードされたBase64のデータ
```
{
  "url": "https://raw.githubusercontent.com/seanno/shc-demo-data/main/cards/cigna-design/jws.txt",
  "flag": "LU",
  "key": "rxTgYlOaKJPFtcEd0qcceN8wEU4p94SqAwIWQe6uX7Q",
  "label": "Demo SHL for cigna-design"
}
```


The SHLink Payload is a JSON object including the following properties:

url: Manifest URL for this SHLink
key: Decryption key for processing files returned in the manifest. 43 characters, consisting of 32 random bytes base64urlencoded.
exp: Optional. Number representing expiration time in Epoch seconds, as a hint to help the SHL Receiving Application determine if this QR is stale. (Note: epoch times should be parsed into 64-bit numeric types.)
flag: Optional. String created by concatenating single-character flags in alphabetical order
L Indicates the SHLink is intended for long-term use and manifest content can evolve over time
P Indicates the SHLink requires a Passcode to resolve
U Indicates the SHLink's url resolves to a single encrypted file accessible via GET, bypassing the manifest. SHALL NOT be used in combination with P.
label: Optional. String no longer than 80 characters that provides a short description of the data behind the SHLink.
v: Optional. Integer representing the SHLinks protocol version this SHLink conforms to. MAY be omitted when the default value (1) applies.
